[toc]







# 江苏省苏州中学研究性学习结题报告

**班级**：高二（1）班，高二（9）班，高二（10）班，高二（11）班，高二（14）班

**课题名称**：流光溢彩数据化——色彩搭配的数据逻辑

**指导老师**：张诗怡老师

**课题组组长**：沈思捷（高二10）

**课题组成员**：邴晨依（高二1） 杨璐冰（高二1） 李泽熙 （高二9） 庄珈言（高二11） 李唯宁（高二11） 祝培森（高二11） 王添慧（高二14）

**小组分工**：

- 沈思捷：组织规划研究，制定方案思路，编写初版程序

- 邴晨依：开展问卷调查并分析总结，设计美化程序外观

- 杨璐冰：搜集查找研究资料文献，撰写各阶段研究报告

- 李泽熙：参与优化程序，美化程序外观，注释程序代码

- 庄珈言：搜集查找研究资料文献，撰写各阶段研究报告

- 李唯宁：参与优化程序，设计程序排版，展望程序应用

- 祝培森：编写以及优化美化程序主力，协调各部分报告

- 王添慧：设计总结采访，编写程序文案，撰写研究报告

## 一、 研究背景

生活中随处可见的色彩搭配，让我们产生了一些思考：什么样的色彩搭配能让人观感舒适？近几年流行的电子绘画的色彩基于什么样的数学规则？我们能否通过通用的程序模型编写科学严谨的流光溢彩？本课题组提出上述问题，展开研究。

## 二、 研究目的及意义

### 我们研究什么？

**研究对象**：色彩的数值与色彩观感间的数据逻辑关系

**研究目标**：通过数据分析、编写程序，分析出科学合理的色彩搭配；根据色彩的差异性给出不同的属性的参考值，其中可以给值较大的几种属性输出不同的配色方案，从而兼顾不同的审美。

### 它能干什么？

**应用设想**：

该配色软件集取色、RGB数值与显色互化、配色方案生成以及渐变填色效果展示于一体，可以基于使用者给定的某一颜色，为使用者提供不同视觉效果的配色方案，将主要应用于美术灵感获取、平面设计参考和日常协助配色等方面。

作为程序的核心内容，配色生成程序是程序组成员综合学习研究了颜色数据化计算和各类色彩搭配理论后，根据对视觉美学的普遍感知，从HSV（色相、饱和度、亮度）三个维度严谨调控数值做出的。可以基于一种颜色同时给出“平缓”、“冲击”、“穆肃”三种方案，现阶段已经可以给出和谐而令人眼前一亮的配色。

认为该部分程序可以应用于大部分涉及色彩搭配的场合。首先，在艺术创作和平面设计方面，随机生成的合理配色可以给创作者提供不同于惯性思维的艺术灵感，从而激发更丰富多样的艺术语言表达，更鲜明地传达多种主题情感，“色彩之于形象，有如伴奏之于歌词，不但如此，有时色彩竟是歌词而形象只是伴奏。”也许色彩的搭配灵感可以让设计者产生更加清晰的形象灵感。同样地，在摄影调色方面，该程序也可以提供相应参考，以多次随机生成的方式模拟目标情感基调和视觉效果。此外，在日常生活中，该程序也可以以不同风格做出简单明了的配色建议，在穿衣搭配、室内设计布置等方面展现更多的可能性，也许可以改善心情和状态。

同时，取色器功能和数值输入显色功能可以良好地结合直观视觉和数据化，让使用者在选择初始颜色时既可以选择特定的RGB值，又可以凭借审美的直觉在取色盘上取色，能够在很大程度上简化程序的操作，助力使用者的创作。

“热爱色彩之人，拥有至为纯洁体贴的心灵。”即使使用者并没有色彩搭配上的实际需求，也不妨把该程序作为一个放松心情的简单小游戏，在欣赏各种美丽新奇配色的同时感受色彩的力量，让光的魔法给生活添一抹亮色。

**展望延伸**：

色彩疗法 颜色对心理和生活的影响在许多方面已经得到了科学的证实，在一些心理康复和疾病辅助治疗中也有应用。因此，该程序可以向“色彩与心理”方向发展，进一步探究颜色和数据之间的联系，尝试增加如“明亮”、“稳定”、“刺激”等心理维度帮助用户通过颜色搭配调整状态、改善生活。

填色/改色软件 目前该程序展示页面上已有安迪沃霍尔玛丽莲梦露的填色演示，由于线条识别和生成配色数量局限，将填色功能应用到任意给出的线条作品或图片上这一想法还尚未能够实现，但其趣味性和应用范围都很有价值，在这方面，也许可以进一步学习研究近年发展迅速的AI绘画软件在颜色处理上的方式。

## 三、 研究方法

采访、问卷调查、文献搜集整理、数据分析、程序模型编写设计

## 四、 研究过程

### 时间线

#### 1. 前期研究

在前期的研究过程中，我们通过采访和问卷调查来了解大众对于配色的了解与需求。在数据分析、编写程序，分析出科学合理的色彩搭配方面，我们进行了详细的分析与讨论，拥有了大致方向，并开始进行后期的程序编写部分。

#### 2. 2021年11—12月

对于主张使用传统颜料的同学和主张现代绘画技术的同学进行采访调查，问卷调查（关于色彩搭配的了解）；编程组同学学习并了解css编程

在这一阶段当中，我们在明确了自己的研究方向和研究目标后，设计了一份调查问卷并通过问卷星的方式进行调查采访。在设计问卷时，我们进行了多次讨论，力求提高问题的针对性和准确度。发放问卷的时候，我们也尽量拓展受访者的范围，在性别、年龄、绘画经验多少等方面呈现多层次化，以便得到更全面的采访结果，进一步提炼出更具普适性的采访结论。

部分讨论过程如下图。

<img src="/home/flandre-zhu/.config/Typora/typora-user-images/image-20220912114215741.png" alt="image-20220912114215741" style="zoom:50%;" />

<img src="/home/flandre-zhu/.config/Typora/typora-user-images/image-20220912114233746.png" alt="image-20220912114233746" style="zoom:50%;" />



#### 3. 2022年1—3月

查阅关于色彩搭配方面的文献资料，对其进行数据分析；编程组同学学习并了解css编程

由于我们在色彩搭配这方面没有系统化的学习，所以知识偏生活化，专业知识掌握程度低。这一阶段我们主要以《配色设计原理》一书为学习内容，小组成员共同阅读学习。

阅读学习专业文献资料的同时，我们撰写了中期报告，其中包括调查的结果和分析、未来研究方向以及困难反思等方面的内容。

部分讨论过程如下图。

<img src="/home/flandre-zhu/.config/Typora/typora-user-images/image-20220912114910123.png" alt="image-20220912114910123" style="zoom:50%;" />

#### 4. 2022年4—7月

此时开始着手程序设计编写。

在前期研究成果的基础上，我们在这一阶段开始编写程序。在此过程中，我们查阅各种文献，不断改进完善程序。与此同时，我们也对于程序呈现出的不同配色组合进行了讨论，分别想出不同的形容词，同时撰写网页简介，对于整体排版的美观进行调整。

部分讨论过程如下图。

<img src="/home/flandre-zhu/.config/Typora/typora-user-images/image-20220912115000653.png" alt="image-20220912115000653" style="zoom: 50%;" />

<img src="/home/flandre-zhu/.config/Typora/typora-user-images/image-20220912115020057.png" alt="image-20220912115020057" style="zoom:50%;" />


#### 5. 2022年8—9月

完成程序编写，整理总结课题研究过程，撰写研究论文

此时进行了一个大更新，加入了两大功能：1. hsv取色器 2. 生成安迪沃霍尔风格的玛丽莲梦露图片

### 程序设计过程

该部分主要由编程组同学负责。

#### 前言

G.Polya 所著的《怎样解题》是一本很有意义的书。它教会我们的远远不止怎么做出一道数学题，而是一种思考的方法。在做这个项目时，我们经常用到本书中的思维方式，思考我们该怎么办。

要设计出一个理想的程序，也如解一道数学题。因此我们用这本书中的思路来想，如何设计我们的程序。下文中也会经常用书中的思考方法，也许明说，也许不明说而潜在的使用。

不一定和原书完全相同，有适当修改。

另外，由于学习压力与疫情等原因，我们的研究被迫分割成了两个阶段。

#### 第一阶段：早期探索

##### 1. 基础色彩理论

大家对“颜色”都不陌生：它是可以被眼睛看到并分辨的；不同颜色的光的物理本质是因为它们的波长不同，不同颜色的物体的物理本质是因为它们具有某种物理性质，可以反射某种了，或某几种颜色的光。

如何用数值描述颜色呢？电脑中是如何描述颜色的？

根据其本质，可以想出用一个实数 $\lambda$ 描述光线的波长。当然，它确实和一种颜色一一对应。但这样很难和人的感受联系起来，在电脑中也很难把这样一个实数转化为一种颜色。

根据“三原色”理论，光都是可以由红光（R），绿光（G），蓝光（B）按比例叠加出来的。从而得到RGB表示：记录三种颜色的光分别有多少亮度。电脑中确实是这样存储并表示出颜色的。如果你拿放大镜观察电脑就会发现，它的一个像素里面都有三个灯，分别是红，绿，蓝色的。要显示一个RGB颜色，就将三个灯调整为不同亮度即可。

研究过程中我们发现，RGB表示还是不够“贴近人”。我们人类是如何描述色彩的？想想看我们的美术书，人类研究颜色通常用 “色相，纯度，明度” 三个量来描述颜色，并且用这些量来描述一幅画给我们的感受。我们看一张古典名画，不可能说 “这张图中明显R值比较高，所以它看起来....” 而是说 “这张图是冷/暖色调，纯度...，明度...，所以它看起来....”（注：纯度即饱和度）

这里引入HSV表示：$H$ 表示色相（Hue），$S$ 表示饱和度（Saturation），$V$ 表示明度（Value）。$H$ 的值在 $[0,360)$ 之间，对应色环上某个角度的颜色。$S,V$ 在 $[0,100]$ 之间，用百分数描述纯度与明度。

##### 2. 研究数值与感觉关系

通过组内的讨论分析，结合相关资料，得出了三种风格的配色方案：

| **配色方案** | **色调** | **饱和度** | **明度** |
| ------------ | -------- | ---------- | -------- |
| **平缓**     | 相差较小 | 相差较小   | 相差较小 |
| **冲击**     | 相差较大 | 相差较小   | 相差较小 |
| **肃穆**     | 黑白灰   | —          | 相差较小 |

（此处“相差”指与输入颜色的属性相较）

我们用 “温澜潮生、桃蹊柳陌、林寒涧肃” 分别形容平缓、冲击、肃穆的配色特点。正如它们所描述的，第一组配色中的颜色都比较接近，而第二组配色则富有对比，第三组则看上去庄严，雅致。



##### 3. 程序设计探索：优化与突破

此时我们对html/css编程了解较少，处于不断摸索的阶段。

第一版：

![image-20220912123458967](/home/flandre-zhu/.config/Typora/typora-user-images/image-20220912123458967.png)

从0到1的突破！但很明显，它有太多问题了。比如肃穆配色的饱和度过高了。改进如下：

<img src="/home/flandre-zhu/.config/Typora/typora-user-images/image-20220912123538415.png" alt="image-20220912123538415" style="zoom:67%;" />

很明显好多了。

第二版：

<img src="/home/flandre-zhu/.config/Typora/typora-user-images/image-20220912123611129.png" alt="image-20220912123611129" style="zoom: 50%;" />

尝试更新了界面的设计。这里我们希望能动态更改下面的文字以显示出每个颜色的十六进制表示，但很明显失败了。此时程序已经相当冗长，不易维护。

第三版：

<img src="/home/flandre-zhu/.config/Typora/typora-user-images/image-20220912123752332.png" alt="image-20220912123752332" style="zoom: 80%;" />

看上去只做了一点小修改，实际上我们把整个程序重构了一遍，使得它更加逻辑清晰易懂且简洁。这样改过以后，再增加新功能就容易了。

这以后学习任务较为繁重，因此这个程序很长时间没有被修改了。直到有一天，我们想起了这个被搁置的计划...

#### 第二阶段：飞速发展

书接上文，我们想起了这个被搁置的计划之后，我们决定对它进行一个飞跃式的大改进。

加入的两个新功能是：1. 点击选择颜色的取色器 2. 根据配色方案生成安迪沃霍尔风格的玛丽莲梦露

功能2为小组讨论时，组长提出的一个设想。当时负责编程的同学一度认为我们的项目中不可能实现这件事，但在大家的努力下，这件事成为了现实，大家都惊喜万分。

##### 1. 总设计思路概述

根据《怎样解题》的理论，我们尝试思考如何设计程序。

首先，理解题意。
1. 已知数据是什么？ 显然，已知数据就是输入的数据。我们的程序希望让用户输入一个颜色，这是一切的开始。
2. 你要求的是什么？ 我们希望是能生成一个配色方案，并且用配色方案画出一个足够好看的图片。这里相当于是有两步。

然后，想办法找到已知量和未知量的关系。要求的未知量有两部分，分步解决。
1. 配色方案如何生成？ 根据其它成员的研究成果，我们将颜色用hsv表示后，一个配色方案可以满足一定的数量关系。
2. 如何用配色方案生成图片？ 我们从大脑中搜索记忆，想起来美术书上安迪沃霍尔的玛丽莲梦露，就是给同一张图片涂上了不同的颜色以达到艺术效果 ———— 没错，用程序做一遍这件事，怎么想都很有趣！ 

我们发现这个步骤2虽然想的很大，但不是那么容易做。我们进行展开分析：怎么生成一个安迪沃霍尔式的玛丽莲梦露呢？
1. 考虑他是怎么做的：根据资料，他是先用丝网制作了一个模板，然后在模板的对应位置放上对应颜色的染料后染出色来
2. 我们如何模拟这个操作呢？显然我们不可能在电脑里做一个丝网和一个染缸出来。我们采取的做法是，拿他的其中一个作品出来进行重新涂色
3. 思考一个 **辅助问题**：如果用手完成这件事，如何做？ 很明显，首先我们找一下图片分为哪几个部分（脸，头发，背景...），对于每个部分，我们涂上不同的颜色即可
4. 解决了这个辅助问题，回到原问题，用变成实现，发现涂颜色这步并不困难，将原来的像素覆盖掉即可。问题主要在于分辨出不同的部分。
5. 如果不同的部分存在不同的特征，分辨就容易做了。因此，我们可以找一张涂的颜色对比很强的图，这样就便于我们对其进行判断了。实际上，我们确实找到了这样一张图，只要把颜色写成hsv后，几乎只h值就能轻松做到判断。
6. 至此，该问题得到了大致的解决，剩下就是细节的调整。

那么接下来要执行你的方案。对于数学题来说这一步再简单不过了，思路都有了，写下来就行。但对于编程来说，这一步也是很大的难点。相当于我们要考虑如何用程序实现。
1. 首先我们处理一下输入，为了方便用户，我们提供一个取色器和一个文本框直接输入
2. 然后根据上面说的办法，生成配色方案与图片
3. 然后还需要把我们写的东西进行一个排版。负责编程的笔者不擅长这件事，交给了组里美术较好的同学。

##### 2. 布局

如图

![](https://gchat.qpic.cn/gchatpic_new/0/0-0-37098FBC30719779ECFEEF4751BB0E79/0?term=3&file=37098fbc30719779ecfeef4751bb0e792701559-1636-1176.png)

（由李唯宁同学设计）

根据该设计图，设计出每个元素的具体位置。详见代码中 css 部分。

实际设计时，先在草稿本上列出细节（位置，颜色，字体大小，等等），实现时参照草稿本来写。这样效率高且不易出错。

##### 3. 输入

输入系统分为取色器和文本框输入。它们可以同时控制用户输入的颜色。

##### 3.1 取色器

取色器的原理是根据hsv，首先用户可以选择 $h$ 值（即，选择“色调”），然后选择 $s$ 值与 $v$ 值。由于我们还剩下两维，因此可以形象的用一个矩形来描述。其中点的两维坐标就对应了其 $s,v$ 值。

考虑 $s,v$ 值的定义，我们发现：$s$ 为饱和度，或者叫纯度。因此我们往色彩里掺进去一些白色，其纯度下降，$s$ 值降低。$v$ 值为明度，可以简单理解为它有多亮，很明显我们往色彩中掺进去一些黑色，其明度下降，$v$ 值降低。

根据这个原理，我们考虑用一个纯色的矩形和一个黑色，白色渐变的矩形进行 **叠加**。具体步骤如下：
- 根据 $h$ 值，我们求出颜色hsv为 $(h,100,100)$ 的那个颜色 $c$。先生成一个由颜色 $c$ 填充的矩形。
- 接着，依次生成两个矩形：首先是一个从白色到完全透明，从左到右渐变的矩形；然后是一个从黑色到完全透明，从下到上渐变的矩形。
- 然后将这两个矩形直接覆盖与原来的纯色矩形上，得到总的色彩矩形。容易发现，在该矩形中，$s$ 值从左到右递增，$v$ 值从下到上递增，且右上角$(s,v)$ 值为 $(100,100)$，左下角 $(s,v)$ 值为 $(0,0)$

那么接下来，对于一个点 $x,y$，知道它到边界的距离，即可求出它代表的 $(s,v)$ 值。获取鼠标位置后，减去左上角的坐标即可。我们需要用事件感应鼠标的移动与点击。

最后我们加上一个颜色显示器，用一个色块和一段文字显示当前的颜色与它的rgb表示。

因此这部分的设计思路为：
1. 加入三个部分：色彩矩形；h值滑条；颜色显示器
2. 色彩矩形中：用一个小圆圈表示当前选中的 $(s,v)$ 点；然后加上三层矩形：纯色，白渐变，黑渐变；加入对鼠标事件的感应。
3. h值滑条中：滑条值域为 $[0,360]$，并且用渐变色生成不同 $h$ 值形成的色带。渐变的参数见 【参考1 - 取色器写法】。h值改变时，需要改变色彩矩形的纯色层。
4. 颜色显示器中：加入一个色块和一个文本框。当上面两项被修改时，动态更新显示的颜色与文本。

详见代码。

##### 3.2 文本框输入

该部分较为简单，用事件判断一下，若文本框中的文本被更改，则更新色彩矩形与当前选中的颜色。

##### 4. 处理与输出

首先是配色方案。 我们提供了三种配色方案，依次为 平缓配色，冲击配色与肃穆配色。参数来自其它成员的工作。

对于平缓配色，其对比并不强，因此用它做玛丽莲梦露效果不佳。我们用它生成一张渐变色的图片。

使用css自带的 ```linear-gradient``` 即可实现。调整参数使效果更好。详见代码。

接下来考虑处理玛丽莲梦露图片。

这是较困难的部分。根据 1.总设计思路概述 中的描述，它分为如下几步：

1. 首先找一张易于分辨的图片
2. 判断出图片的不同部分（脸，头发，背景...）
3. 对于不同部分，填入准备好的配色
4. 对生成的图片进行调整

##### 4.1 step 1,2

我们需要这样的图： 1. 大小合适，即不太小，方便操作；又不太大，处理起来不会很慢 2. 对比足够强，方便分辨出各个部分

大概多少大小呢？ 先考虑运行时间。javascript 语言比起 python 来稍快，但和 C++ 一比又不算很快，在语言中算是中等水平。一秒进行的基本运算（如加减乘除）次数在 $10^7$ 级别。

对于一张图片，我们涉及的操作基本上都是枚举每个像素，并进行某某操作。因此执行的基本操作数为：某个常数乘以图片的大小。

该常数的大小取决于我们对图片进行的整体操作的次数和每次操作的复杂程度。注意到这个问题较为困难，因此该常数可以预见的比较大，而且我们希望它的运行时间尽量在一两秒左右。从而图片大小在 $10^6$ 级别比较好，最好稍微小点，就不用加载很久了。但考虑到图片不能太小不然不好操作，因此图片的长宽大概在 $[500,1000]$ 区间里是比较适合的，单位为像素（px）。

经过一番筛选，我们找到了这张图：

<img src="https://cdn.luogu.com.cn/upload/image_hosting/5ygjjaxn.png" style="zoom: 33%;" />

它的大小约为 700px 见方，正好合适。通过取色工具看出，其脸部的 $h$ 值在 $355$ 上下，头发的 $h$ 值在 $45$ 上下，背景的 $h$ 值在 $175$ 上下，眉毛的 $h$ 值在 $200$ 上下。虽然眉毛和背景较为接近，但也有区别，能够区分。

研究过程中我们发现，可以将某个部分单独拿出来，涂成红色，就可以判断它分辨的是否正确。例如下图为研究过程中的一张图。

<img src="/home/flandre-zhu/Pictures/Screenshots/pic1.png" style="zoom:33%;" />

可以看出它判断的大概准确。

##### 4.2 step 3,4

第三步就直接覆盖颜色即可，考虑优化效果。此时的效果如下图。

<img src="/home/flandre-zhu/Pictures/Screenshots/pic2.png" style="zoom:33%;" />

发现它看起来很粗糙。虽然大体差不多了，但一些小地方还会偶尔冒出来一个我们不希望出现的颜色，像是“碎了”一样。而且，一大块地方全都是一样的颜色，十分单调。

问题很多，逐个解决。

首先它会在我们不希望的位置出现。用上述的单独抽出来标红的方法，我们发现，该现象出现经常是因为我们的程序误判了很黑的块。很容易理解，一个比较黑的块，它就算是“一点点红”或者“一点点蓝”，肉眼很难看出来，但会被程序判断出来。而我们判断它是否正确的依据其实还是肉眼，所以我们不认为它这个判断是正确的。这个问题的解决方案为，求出该像素的灰度，对于灰度较小的像素，保留其原来的样子不替换。

> 关于灰度：详见 【参考2-维基百科 Grayscale】
>
> 这里采用的是 $Y=0.299R+0.587G+0.114B$ 公式

这样效果其实已经好多了，如下图

<img src="/home/flandre-zhu/Pictures/Screenshots/pic3.png" style="zoom:33%;" />

我们再接着优化。注意到部分地方（如她的嘴里以及头发的部分地方），虽然不是很黑但也被误判了。但经过上面的优化，这些地方都很零散且面积较小。此时采用如下降噪算法：用广度优先搜索算法找到所有面积较小的块，并取消该块的覆盖。

##### 4.2.1 图论基础与广度优先算法

图论是数学的一个分支，研究图这一结构。简单的说，图由若干点和边组成，点之间由边相连，并且点可以通过边走到其它的点上。边可以是有向的，也可以是无向的（用单行道和双向车道来理解这件事）。此处我们不研究只有一个方向的有向边，只关注两个方向都可以走的无向边。

如果点 $u,v$ 之间有一条无向边，那么我们认为 $u$ 可以走到 $v$，$v$ 也可以走到 $u$。

图 $G$ 可以由两个集合 $V,E$ 来描述，记作 $G=(V,E)$。$V$ 表示点集，$E$ 表示边集。

[该网站](https://csacademy.com/app/graph_editor/) 提供了一个图论的画图器，可以用它画出一张图。

下图为一个 $6$ 个点 $11$ 条边的图 （后面默认“图”都是无向图）。

<img src="/home/flandre-zhu/Pictures/Screenshots/pic5.png" style="zoom:67%;" />

这张图中，从任意一个点出发都可以到达所有的点，或者我们发现它所有点都连在一起。而事实上，图不一定全都是连在一起的。对于一个集合 $S\subseteq V$，$S$ 中任意一个点均可以到达 $S$ 中所有点，并且不存在 $x$ 使得 $S$ 加入 $x$ 后仍满足该性质，称 $S$ 为一个 **连通块**。

原问题可以抽象成这个图论模型：
- 将图中每个像素看成点，并对颜色种类进行识别
- 如果相邻两个像素颜色种类相同，在两点间连一条无向边
- 找到所有大小不超过某个值的连通块

核心问题在于找到所有连通块。我们使用 **广度优先搜索（Breadth First Search, BFS）** 解决这个问题。

广度优先搜索算法 （BFS）：

对于一张图 $G$ 和一个起点 $S$，我们从起点 $S$ 出发，依次加入：走一步能到的点；走两步能到的点；走三步能到的点...

可以想象成一滴水落入湖中泛起的涟漪，一圈，两圈...如果没有能量损耗，那么这些涟漪必定能扫过整个湖面。

具体的，首先我们有一个起点 $S$，维护集合 $T_i$ 表示走 $i$ 步能到的点集，初始 $T_0=\{S\}$。

假设我们已知 $T_i$，枚举 $T_i$ 中的每个点 $u$，若它能到点 $v$，且 $v$ 在 $T_0...T_i$ 中未出现过（即它是一个新到的点），则在 $T_{i+1}$ 中加入 $v$。

如何维护该过程呢？ 

使用 队列（queue） 数据结构维护。队列是满足一边进另一边出的数据结构，先进去的元素一定会先出来。想象食堂里打饭的队伍，人只会从前面出去，并从后面加入，并且先去排队的人一定会先拿到饭。

利用队列，我们用如下办法维护：

1. 初始时将 $T_0$ 中的元素加入队列中。
2. 每次枚举队首，把它能到的新点加入队列尾后，将它出队列。
3. 不断这样做，直到队列为空。我们发现，由于我们只加入 **新** 点，到后面就没有新点了，队列就会不断变小直到空。

容易发现，如果每次枚举的队列头是 $T_i$ 中的元素，那么加入的元素一定就是 $T_{i+1}$ 中的元素。然后它们会在后面被枚举，并加入 $T_{i+2}$ 中的元素入队列...该过程不断持续直到它没法到达新的点了。此时，所有进过队列的点（包括 $S$），就是 $S$ 所在连通块中的所有点。

由于我们只会加入 **新** 点，从而每个点只会被加入恰好一次，并且被删除恰好一次。因此该算法执行的操作数是线性于连通块大小的，且常数较小，效率相当优秀。

队列的维护，只需要维护一个序列和两个指针 head,tail。x入队列，就是 ```Q[++tail]=x```；将队首出队列，只需要 ```++head```。

大致代码如下
```plain
BFS(S):
    Q=一个足够长的序列; head=1,tail=0
    vis=一个足够长的序列；（它用来判定每个点是否已经访问过了）
    Q[++tail]=S
    while(head<=tail)
        u=Q[head++]; vis[u]=1;
        for(u->v)if(!vis[v]) vis[v]=1,Q[++tail]=v;
    最后取 Q[1...tail] 即为连通块中的点。
```

用该算法即可找到所有连通块，判断它的大小是否比较小。代码中取 $1500$，即，将所有大小不超过 $1500$ 的连通块删掉。

加上这个优化以后，判定就差不多了，只是还剩下色彩单调的问题。我们采取调整明度的做法：对于一个像素，它的明度和原图中该像素的明度取平均值。这样我们填入的颜色就具有了明暗变化，而非单调的颜色了。

这样加起来基本上就是最终效果了，如下图（下图缩小了 $3$ 倍）。虽然还有瑕疵，但是根据排版，该图片要缩小 $7$ 倍，剩下的瑕疵就可以忽略不计了。

<img src="/home/flandre-zhu/Pictures/Screenshots/pic4.png" style="zoom:33%;" />

将其缩小 $7$ 倍，放入排版中准备好的区域内即可。至此，问题得到完整的解决。

#### 参考

1. [取色器的写法参考](https://blog.csdn.net/qq_38062409/article/details/84974509)
2. [维基百科 - Grayscale](https://en.wikipedia.org/wiki/Grayscale)
3. [canvas的使用](https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API)


## 五、 研究结果及总结

我们已将研究结果上传至 [这里](https://flandre-zhu.github.io/zhu/colors.html)

程序效果图：

<img src="https://gchat.qpic.cn/gchatpic_new/0/0-0-BD01E62601B7C70FF319303420928EC9/0?term=3&file=bd01e62601b7c70ff319303420928ec9136574-2160-1191.png" alt="img" style="zoom: 50%;" />

**总结反思：**

在研究性学习的后期，我们在编写程序方面取得了很大进展，首先，我们解决了在中期报告中提出的几个未来问题：如何形容色彩属性？如何描述搭配出的颜色组？如何将色彩属性和颜色的搭配结合起来？其次，我们通过统筹协商，对网页部分的整体观感进行了统筹调整，包括讨论形容词、选取背景图片等，使其更加合理美观，呈现出更强的整体性、便捷性和观赏性。

我们对研究过程中的不足进行了反思。由于课业繁重，我们的研究常常不能按计划照常执行，每个人的任务都很重，也经常会出现纰漏。好在在各方同学、老师以及专业人士的帮助下，我们的程序编写以及最终的网页展示按计划很好地呈现了。在此我们也要对这些对我们给予帮助的人表示最真挚的感谢。

## 六、研究感悟

历时一年，我们的研究性学习活动终于走向了尾声。在这一年里，从前期的立项讨论到研究的稳步推进，离不开每一个成员的努力。

- 因兴趣而凝聚
  高一上学期的时候，出于对于色彩研究的兴趣，我们聚在了一起。经过不断的讨论，我们细化了选题，把范围框定在“通过数据分析、编写程序，给出科学合理的色彩搭配。”但仅仅有兴趣是不够的，还需要有大量的时间研究，更需要合理的分工调配。我们的分工是科学且高效的。

- 排除万难中前进
    身为高中的学生，课业繁重，我们并没有很多的时间进行我们的研究。其中更有参与竞赛的学生，他们兼顾学业和竞赛，空余时间很少。但通过课间和周末的时间，我们很快完成了前期采访和问卷的信息收集工作。信息组的同学们更是抓紧一切空闲自学了编程，为后续程序设计打下了坚实的基础。

- 让不可能成为可能
    初代的程序只有随机输入数字生成三组配色的能力。学习编程以后的我们对于程序设计的复杂与高要求有了新的理解。本打算放弃最初的设想，但在最后的一个多月里，信息组的同学们把许多“不可能”都做成了现实，比如在页面中加入取色器，比如用生成的配色做出类似于安迪沃霍尔的玛丽莲梦露效果图。这些成功都让我们惊喜不已。
    

通过这一次的研究性学习，我们得到的绝不仅仅是一个有意思的小程序，更有丰富的想象力，有合理分配时间的能力，有努力实现目标的勇气，有踏踏实实、认真对待任务的品质。

## 七、 家长评语

## 八、 老师评语